# template file to be used for MTCC data, the script substitutes the list of files and similar
  process MTCCMONITORING = {
  # MessageLogger
    include "FWCore/MessageLogger/data/MessageLogger.cfi"
  
  # input files
    source = PoolSource
    {
     untracked vstring fileNames = {
              SCRIPT_LIST_OF_FILES
     }
     untracked int32 maxEvents = -1
     untracked uint32 debugVebosity = 1
     untracked bool   debugFlag     = true
    }
  
  # Tracking ---------------------------------------------
  #   include "RecoTracker/SingleTrackPattern/test/messages.cfg"
    include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitMatcher.cfi"
    #
    # include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitConverter.cfi"
    module siStripMatchedRecHits = SiStripRecHitConverter{
       untracked int32 VerbosityLevel = 1
       string ClusterProducer = "siStripClusters345"
       string StripCPE = "StripCPEfromTrackAngle"
       string Matcher = "StandardMatcher"
       string matchedRecHits = "matchedRecHit"
       string rphiRecHits = "rphiRecHit"
       string stereoRecHits = "stereoRecHit"
    }
  ############ initialize magnetic field #########################
    # include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
    include "MagneticField/Engine/data/uniformMagneticField.cfi"
    # replace UniformMagneticFieldESProducer.ZFieldInTesla = 3  # default value of ZFieldInTesla is zero
  ############### initialize geometry #####################
    include "Geometry/CMSCommonData/data/cmsMTCCGeometryXML.cfi"
    include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"
    include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"
    include "RecoTracker/GeometryESProducer/data/TrackerRecoGeometryESProducer.cfi"
  # stripCPE
    include "RecoLocalTracker/SiStripRecHitConverter/data/StripCPEfromTrackAngle.cfi"
  # pixelCPE
    include "RecoLocalTracker/SiPixelRecHits/data/PixelCPEParmError.cfi"
  #TransientTrackingBuilder
    include "RecoTracker/TransientTrackingRecHit/data/TransientTrackingRecHitBuilder.cfi"
  ############### generate seeds ###########################
  # include "RecoTracker/TkSeedGenerator/data/CosmicSeed_MTCC.cfi"
   module cosmicseedfinder= CosmicSeedGenerator{
     InputTag matchedRecHits = siStripMatchedRecHits:matchedRecHit
     InputTag rphirecHits    = siStripMatchedRecHits:rphiRecHit
     InputTag stereorecHits   = siStripMatchedRecHits:stereoRecHit
     double ptMin=0.9
     double originRadius=150
     double originHalfLength=90
     double originZPosition=0
     string TTRHBuilder        =  "WithTrackAngle"	
     untracked string GeometricStructure  = "MTCC"
    }
  ############### find tracks ##############################
  # include "RecoTracker/SingleTrackPattern/data/CosmicTrackFinder_MTCC.cfi"
  module cosmictrackfinder= CosmicTrackFinder{
   string HitProducer        = "siStripRecHits"   
   int32 MinHits= 3  # 4
   double Chi2Cut=30 # 10.
   string TTRHBuilder   =       "WithTrackAngle"
   untracked  string GeometricStructure ="MTCC"
     InputTag matchedRecHits = siStripMatchedRecHits:matchedRecHit
     InputTag rphirecHits    = siStripMatchedRecHits:rphiRecHit
     InputTag stereorecHits   = siStripMatchedRecHits:stereoRecHit
  }
  #-------------------------------------------------------


  # Filters ----------------------------------------------
  # Cluster Filter
    module ClusterMTCCFilter = ClusterMTCCFilter
    {
      string  ClusterProducer = "siStripClusters345"
      # thresholds
      int32 ChargeThresholdTIB = 25
      int32 ChargeThresholdTOB = 25
      int32 ChargeThresholdTEC = 70
      # at least 'MinClustersDiffComponents' sub-components (TIB1, TIB2, TIB3, TOB1, TOB2, TEC)
      # with clusters over above respective thresholds
      int32 MinClustersDiffComponents = 3
      # detector modules to be excluded
#      vuint32 ModulesToBeExcluded = {369214217, 369214218 }
      vuint32 ModulesToBeExcluded = { }
    }
  # Track Filter
    module TrackMTCCFilter = TrackMTCCFilter
    {
      string  TrackProducer = "cosmictrackfinder"
      string TrackLabel     = ""
      int32 MinNrOfTracks = 1
    }
  #-------------------------------------------------------

  # DQM --------------------------------------------------
  # DQM services
    service = DaqMonitorROOTBackEnd{}
  # MonitorTrackGlobal
    include "DQM/TrackerMonitorTrack/data/MonitorTrackGlobal.cfi"
    replace MonitorTrackGlobal.MTCCData=true
    replace MonitorTrackGlobal.TrackProducer="cosmictrackfinder"
  # Trigger Monitoring, SiStripMonitorHLT
    include "DQM/SiStripMonitorCluster/data/SiStripMonitorHLT.cfi"
    replace SiStripMonitorHLT.HLTProducer="ClusterMTCCFilter"
    replace SiStripMonitorHLT.OutputMEsInRootFile = true
    replace SiStripMonitorHLT.OutputFileName = "SCRIPT_DQM_OUTPUT_FILE"
  #-------------------------------------------------------
  
  module out = PoolOutputModule 
    { 
      untracked string fileName = "SCRIPT_POOL_OUTPUT_FILE"
    }
  
  ################# Schedule
   # trigger
     path filter                    = {
                                      ClusterMTCCFilter,
                                      siStripMatchedRecHits,
                                      cosmicseedfinder,
                                      cosmictrackfinder,
                                      MonitorTrackGlobal
     }
   # monitor for every event the trigger decision
   path phltdqm                 = {SiStripMonitorHLT}
   #
#   endpath e = {ClusterMTCCFilter,out} # save events in pool file
   endpath e = {ClusterMTCCFilter,TrackMTCCFilter,out} # save events in pool file
  }
