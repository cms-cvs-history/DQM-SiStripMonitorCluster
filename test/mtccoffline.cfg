process SISTRIPDQMDIGISCLUSTERS = {

  # MessageLogger
  include "FWCore/MessageLogger/data/MessageLogger.cfi"

  # magnetic field
#  include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"

  # geometry (switched to tracker only geometry)
#  include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"

  # tracker geometry
#  include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"

  #
#  es_module = TrackerGeometricDetESModule {}


  # tracer service - very verbose - useful for debugging only
#  service = Tracer { untracked string indention = "$$"}

  # source of simulated hits
#  source = DQMSafePoolSource


  source = PoolSource
  {
    untracked vstring fileNames = {"file:/tmp/gbruno/mtcc.00001745.A.testStorageManager_0.0.root"}
    untracked int32 maxEvents = 10
    untracked uint32 debugVebosity = 1
    untracked bool   debugFlag     = true
  }

#include "IORawData/SiStripInputSources/data/TBRUInputSource.cfi"
#replace TBRUInputSource.fileNames = { "file:/afs/cern.ch/cms/cmt/onlinedev/data/RU0030349_000.root" }
#replace	TBRUInputSource.maxEvents = 10



# SiStripDigitizer
#  include "SimTracker/SiStripDigitizer/data/SiStripDigi.cfi"

# SiStripRaw2digi
include "EventFilter/SiStripRawToDigi/data/RawToDigi.cfi"

# ZeroSuppressor
include "RecoLocalTracker/SiStripZeroSuppression/data/SiStripZeroSuppression.cfi"

# include SiStripClusterizer
include "RecoLocalTracker/SiStripClusterizer/data/SiStripClusterizer_RealData.cfi"


  # get SiStripFedCabling from sqlite_file
  #  es_source pool1 = PoolDBESSource
  #  {
  #       VPSet toGet = {
  #          { string record = "SiStripFedCablingRcd"
  #            string tag = "SiStripFedCabling_v1"
  #          }
  #       }
  #       bool loadAll = true
  #       string connect = "sqlite_file:sistripfedcabling.db"
  #       untracked string catalog = "file:SiStripFedCablingCatalog.xml"
  #       string timetype = "runnumber"
  #       untracked uint32 authenticationMethod = 1
  #       untracked uint32 messagelevel = 10
  #  }


#read cabling from db
include "OnlineDB/SiStripESSources/data/BuildFedCablingUsingConfigDb.cfi"
replace BuildFedCablingUsingConfigDb.UsingDb = true
replace BuildFedCablingUsingConfigDb.User = "cms_mtcc_sitracker"
replace BuildFedCablingUsingConfigDb.Passwd = "cms_mtcc"
replace BuildFedCablingUsingConfigDb.Path = "omds"
replace BuildFedCablingUsingConfigDb.Partition = "MTCC_TESTCI_NEW"

#read in pedestals
es_source = PoolDBESSource { 
              VPSet toGet = {
                { string record = "SiStripPedestalsRcd"
                  string tag = "SiStripPedestals_v1"
                }
               ,{ string record = "SiStripNoisesRcd"
                  string tag = "SiStripNoises_v1"
                } 
              }
              bool loadAll = true
              string connect = "sqlite_file:insert_SiStripPedNoisesDB"
	      untracked string catalog = "file:insert_SiStripPedNoisesCatalog" 
              string timetype = "runnumber" 
              untracked bool loadBlobStreamer = true

	      untracked uint32 authenticationMethod = 0
              untracked uint32 messagelevel = 3
            }



    # produce SiStripFecCabling and SiStripDetCabling out of SiStripFedCabling
    es_module sistripconn = SiStripConnectivity {}

    # DQM services
    service = DaqMonitorROOTBackEnd{}

    # tracer service - very verbose - useful for debugging only
#    service = Tracer { untracked string indention = "$$"}

    # can comment out MonitorDeamon if you want to run without DQMCollector - this should go as include in DQMServices
#    include "DQM/SiStripMonitorCluster/data/MonitorDaemon.cfi"
#    replace MonitorDaemon.DestinationAddress = "lxcmse1.cern.ch"



    # SiStripMonitorDigi
#    include "DQM/SiStripMonitorDigi/data/SiStripMonitorDigi_SimData.cfi"
    # use the following flag to select all detectors (e.g. for mtcc data). by default is false
#    replace SiStripMonitorDigi.SelectAllDetectors = true
       
    # SiStripMonitorCluster
    include "DQM/SiStripMonitorCluster/data/SiStripMonitorCluster.cfi"
    # use the following flag to select all detectors (e.g. for mtcc data). by default is false
    replace SiStripMonitorCluster.SelectAllDetectors = true
    # use following to utput all histograms in a file
    replace SiStripMonitorCluster.OutputMEsInRootFile = true

# Trigger
     module trigger = MTCCHLTrigger
     {
       bool SelOnDigiCharge=false
       int32 ChargeThreshold=180 # threshold must be larger for collisions (23000 or so for 156 modules selected)
       string  ClusterProducer = "siStripClusters"
     }

# Trigger Monitoring, SiStripMonitorHLT
  include "DQM/SiStripMonitorCluster/data/SiStripMonitorHLT.cfi"

#  module EventContentAnalyzer = EventContentAnalyzer {}
#  module out = PoolOutputModule 

# prescaler module
  module Prescaler = Prescaler{ int32 prescaleFactor = 1}


################# Schedule
    # reconstruction
    path pdigitize_clusterize    = { siStripDigis,theSiStripZeroSuppression,siStripClusters }
    # digi and cluster monitoring only the ones that pass the hlt
    path pdqm                    = {trigger,Prescaler,SiStripMonitorCluster}
    # monitor for every event the trigger decision
    path phltdqm                 = {SiStripMonitorHLT}
}
