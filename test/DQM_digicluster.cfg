process PROD = {

   service = MessageLogger {
      vstring destinations = 
           {
                   "dqm_digicluster_warning.txt",
                   "dqm_digicluster_debug.txt",
                   "dqm_digicluster_info.txt",
                   "cerr"
           }
           PSet critical.txt = 
           {
                   string threshold = "ERROR" 
                   PSet default = { int32 limit = 0 }
           }
           PSet detailed.txt = 
           {
                   string threshold = "DEBUG" 
                   PSet default = { int32 limit = 0 } 
           }
           PSet dqm_digi_info.txt = 
           {
                   string threshold = "INFO" 
                   PSet default = { int32 limit = 0 }
           }
           PSet cerr = 
           {
                   string threshold = "WARNING" 
                   PSet default = { int32 limit = 0 }
           }
      }


	source = PoolSource { 
          untracked vstring fileNames = {'file:SingleMuonSimHits.root'}
          untracked int32 maxEvents = 10
          untracked uint32 debugVebosity = 10
          untracked bool   debugFlag     = true
	}


	es_source magfield = XMLIdealGeometryESSource {
		  FileInPath GeometryConfiguration ="Geometry/CMSCommonData/data/FieldConfiguration.xml"
		  #the proper root node is set in the xml file
		  string rootNodeName=""
		}
        es_module = VolumeBasedMagneticFieldESProducer {
 	           double findVolumeTolerance = 0.0
 	           untracked bool cacheLastVolume = true
	           untracked bool timerOn = false
		}


	es_source = XMLIdealGeometryESSource {
	FileInPath GeometryConfiguration="Geometry/TrackerSimData/data/trackerSimConfiguration.xml" 
	string rootNodeName = ""
	}
        es_module = TrackerGeometricDetESModule {}
        es_module = TrackerDigiGeometryESModule {}

// sistripdigi
include "SimTracker/SiStripDigitizer/data/SiStripDigi.cfi"


        module ThreeThresholdClusterizer =  SiStripClusterizer {
                string DigiProducer        = "stripdigi"
                untracked string userEnv   = "me"
                untracked string passwdEnv = "me"
           bool UseNoiseBadStripFlagFromDB = false

                string ClusterMode         = "ThreeThresholdClusterizer"
                double ChannelThreshold    = 2.0
                double SeedThreshold       = 3.0
                double ClusterThreshold    = 2.0
                 int32 MaxHolesInCluster   = 1  

                double ElectronPerAdc      = 313.0 
                double EquivalentNoiseCharge300um = 2160.
                double BadStripProbability = 0.002
        }


// new for DQM
       es_source = PoolDBESSource {
                     VPSet toGet = {
                       { string record = "SiStripReadoutCablingRcd"
                         string tag = "SiStripReadoutCabling_v1"
                       }
                     }
                     bool loadAll = true
                     string connect = "sqlite_file:sistripcabling.db"
                     string timetype = "runnumber"
                     untracked uint32 authenticationMethod = 1         
                     untracked uint32 messagelevel = 0
                   }

       service = DaqMonitorROOTBackEnd{}

// can comment out MonitorDeamon if you want to run without DQMCollector
       service = MonitorDaemon{
       # if true, will automatically start DQM thread in background
       untracked bool AutoInstantiate=true   
       # if >=0, upon a connection problem, the source will automatically 
       # attempt to reconnect with a time delay (secs) specified here 
       # (default: 5)
       untracked int32 reconnect_delay = 5
       # collector hostname; examples: localhost(default),lxcmse2.cern.ch, etc
       untracked string DestinationAddress = "localhost"
       # port for communicating with collector (default: 9090)
       untracked int32 SendPort = 9090
       # monitoring period in ms (i.e. how often monitoring elements 
       # are shipped to the collector; default: 1000)
       untracked int32 UpdateDelay = 1000
       # name of DQM source (default: DQMSource)
       untracked string NameAsSource = "FU0" 
       }

       es_module = SiStripStructureBuilder {}

       module digimonitor = SiStripMonitorDigi {
                               string DigiProducer="stripdigi"
                               bool ShowMechanicalStructureView = true
                               bool ShowReadoutView = false
                               bool ShowControlView = false
                               bool OutputMEsInRootFile = false
                               string OutputFileName="test_digi.root"
                            }

       module clustermonitor = SiStripMonitorCluster {
                               string ClusterProducer="ThreeThresholdClusterizer"
                               bool ShowMechanicalStructureView = true
                               bool ShowReadoutView = false
                               bool ShowControlView = false
                               bool OutputMEsInRootFile = true
                               string OutputFileName="test_digi_cluster.root"
                               }

               module out = PoolOutputModule {
               untracked string fileName = 'stripdigi.root'
        }

       path p = {stripdigi,ThreeThresholdClusterizer,digimonitor,clustermonitor}
}
