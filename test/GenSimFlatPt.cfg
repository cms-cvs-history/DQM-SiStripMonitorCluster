process GENSIMFLATPT = {

  # MessageLogger
  include "FWCore/MessageLogger/data/MessageLogger.cfi"

  # tracer service - very verbose - useful for debugging only
#  service = Tracer { untracked string indention = "$$"}

  # timing
  service = Timing {}

  service = RandomNumberGeneratorService
  {
       untracked uint32 sourceSeed = 135799753
       PSet moduleSeeds =
       {
          untracked uint32 VtxSmeared = 123456789
       }
  }
   
  include "SimGeneral/HepPDTESSource/data/pdt.cfi"

  #=========================================================================================
  # Step 1 : Event Generation
  # flat random E-gun, single muon
  # this will run single/multi particle pt-gun
  # the pt of the particles with be uniformly
  # distributed in the user-specied pt-range 
  # particles (HepMCPRoduct) will be placed 
  # into edm::Event 
  source = FlatRandomPtGunSource 
  { 
     untracked uint32 firstRun  =  1
     untracked int32  maxEvents = 200
     untracked PSet  PGunParameters =
     {
       # you can request more than 1 particle
       #untracked vint32  PartID = { 211, 11, -13 }
       untracked vint32 PartID = {211} 
       untracked double MinEta = 1.
       untracked double MaxEta = 1.5
       #
       # phi must be given in radians
       #
       untracked double MinPhi = -3.14159265358979323846
       untracked double MaxPhi =  3.14159265358979323846
       untracked double MinPt  =  9.99
       untracked double MaxPt  = 10.01
     }
     untracked int32 Verbosity = 0 # set to 1 (or greater)  for printouts
  }

   # event vertex smearing - applies only once (internal check)
   # Note : all internal generatoes will always do (0,0,0) vertex
   #
   module VtxSmeared = VertexGenerator
   {
      string type = "IOMC/EventVertexGenerators/GaussianEventVertexGenerator"
      double MeanX = 0.
      double MeanY = 0.
      double MeanZ = 0.
      double SigmaX = 0.015
      double SigmaY = 0.015
      double SigmaZ = 53.0  // in mm (as in COBRA/OSCAR)
   }


   #Geometry
   include "Geometry/CMSCommonData/data/cmsSimIdealGeometryXML.cfi"
   es_module = TrackerGeometricDetESModule {}

   #Magnetic Field
   include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"

   # Step 2 : CMS Detector Simulation
   # CMS Geant4-based Det.Simulation module (OscarProducer)
   include "SimG4Core/Application/data/SimG4Object.cfi"

  module out = PoolOutputModule 
  { 
     untracked string fileName = "FlatPtSimHits.root"
  }


  path p =
  {
              VtxSmeared, #  . . .
              g4SimHits # detector simulation
  }

   endpath e = {out} # write out the simulated hits in a file
}
