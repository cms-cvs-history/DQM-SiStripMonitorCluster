process SISTRIPDQMDIGISCLUSTERS = {

  # MessageLogger
  include "FWCore/MessageLogger/data/MessageLogger.cfi"
#  include "DQM/SiStripCommon/data/MessageLogger.cfi"

  # timing
#  service = Timing {}

  #Geometry
   #
   include "Geometry/CMSCommonData/data/cmsSimIdealGeometryXML.cfi"
   include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"

   # magn. field
   include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"

   # required for Pixel and SiStrip Digitizers
   include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"

  #=========================================================================================
  # source of simulated hits
#  source = DQMSafePoolSource
  source = PoolSource
  {
    untracked vstring fileNames = {
      "file:FlatPtSimHits.root",
      "file:FlatPtSimHits.root",
      "file:FlatPtSimHits.root"
    }
    untracked int32 maxEvents = -1
    untracked uint32 debugVebosity = 1
    untracked bool   debugFlag     = true
  }
  #=========================================================================================

  # SiStripDigitizer
  include "SimTracker/SiStripDigitizer/data/SiStripDigi.cfi"

  # include SiStripClusterizer
  include "RecoLocalTracker/SiStripClusterizer/data/SiStripClusterizer_SimData.cfi"

  # get SiStripFedCabling from sqlite_file
    es_source pool1 = PoolDBESSource
    {
         VPSet toGet = {
            { string record = "SiStripFedCablingRcd" string tag = "SiStripFedCabling_v1"}}

         bool loadAll = true
         string connect = "sqlite_file:sistripfedcabling.db"        
         string timetype = "runnumber"
         untracked string BlobStreamerName="DefaultBlobStreamingService"
      
         PSet DBParameters = {
           untracked uint32 authenticationMethod = 1
           untracked uint32 messagelevel = 10
         }
    }

    # produce SiStripFecCabling and SiStripDetCabling out of SiStripFedCabling
    es_module sistripconn = SiStripConnectivity {}

    # DQM services
    service = DaqMonitorROOTBackEnd{}

    # tracer service - very verbose - useful for debugging only
#    service = Tracer { untracked string indention = "$$"}

    # can comment out MonitorDeamon if you want to run without DQMCollector - this should go as include in DQMServices
    include "DQM/SiStripMonitorCluster/data/MonitorDaemon.cfi"
    replace MonitorDaemon.DestinationAddress = "localhost"

    # mixing module
    include "DQM/SiStripMonitorCluster/data/MixingModule.cfi"

    # SiStripMonitorDigi
    include "DQM/SiStripMonitorDigi/data/SiStripMonitorDigi_SimData.cfi"
    # use the following flag to select all detectors (e.g. for mtcc data). by default is false
#    replace SiStripMonitorDigi.SelectAllDetectors = true

    # SiStripMonitorCluster
    include "DQM/SiStripMonitorCluster/data/SiStripMonitorCluster.cfi"
    # use the following flag to select all detectors (e.g. for mtcc data). by default is false
#    replace SiStripMonitorCluster.SelectAllDetectors = true
    replace SiStripMonitorCluster.OutputMEsInRootFile = true

# Trigger
     module trigger = MTCCHLTrigger
     {
       bool SelOnDigiCharge=false
       int32 ChargeThreshold=180 # threshold must be larger for collisions (23000 or so for 156 modules selected)
       string  ClusterProducer = "siStripClusters"
     }

# Trigger Monitoring, SiStripMonitorHLT
  include "DQM/SiStripMonitorCluster/data/SiStripMonitorHLT.cfi"

  module EventContentAnalyzer = EventContentAnalyzer {}

# prescaler module
  module Prescaler = Prescaler{ int32 prescaleFactor = 1}

################# Schedule
    # reconstruction
    path pdigitize_clusterize    = {mix,siStripDigis,siStripClusters}
    # digi and cluster monitoring only the ones that pass the hlt
    path pdqm                    = {trigger,Prescaler,SiStripMonitorDigi,SiStripMonitorCluster}
    # monitor for every event the trigger decision
    path phltdqm                 = {SiStripMonitorHLT}
}
